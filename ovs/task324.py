def p(g):k,K,b,B=sorted({*sum(g,[])},key=sum(g,[]).count);return[[([[k,K][k!=C!=[B,b][all({k,B}!={*r}!={K,b}for r in[*zip(*g)]+g)]]for y,r in enumerate(g)for x,c in enumerate(r)if c in(k,K)!=abs(x-X)==abs(y-Y)]+[C])[0]for X,C in enumerate(r)]for Y,r in enumerate(g)]

## 242 unzipped:
def p(g,e=enumerate):s=sum(g,[]);k,K,b,B=sorted({*s},key=s.count);return[[([[k,K][k!=C!=[B,b][all({k,B}!={*r}!={K,b}for r in[*zip(*g)]+g)]]for y,r in e(g)for x,c in e(r)if c in(k,K)!=abs(x-X)==abs(y-Y)]+[C])[0]for X,C in e(R)]for Y,R in e(g)]
