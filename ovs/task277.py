p=lambda g,k=-15,h=1,q=[0]*9:k*g or p([q:=[v and[2-v//max(f:=sum(g,[])),h:=h*2,*[P|p|v]*6,f.count(v)][k//2]for P,p,v in zip([0]+q,[0]+r,r)]for*r,in zip(*g[::-1])],k+1)

## 187
def p(g):
 *A,=enumerate(sum(g,M:=[]))
 for j,v in A*6:M+={0},;M[j]=s={(p:=y+y//10-j-j//10)*(abs(p-I)in b'\0\n'*v*V)for y,V in A for I in M[j]};g[j//10][j%10]=3&4>>M.count(s)
 return g
