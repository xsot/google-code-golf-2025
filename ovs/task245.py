p=lambda i,k=7:-k*i or p([*map(lambda*r,w=0:[[w%3,w:=v][v%2+5>sum({*max(i)})]for v in r],*i)],k-1)

## fails a single case:

p=lambda i,k=15:-k*i or p([([0]*(2in{*max(i,key=any)}&{*r})+r)[:len(r)]for*r,in zip(*i)][::-1],k-1)
