p=lambda i:[(e:=0)or[[e:=y-e,5][e<0]for y in x]for x in i]

##

p=lambda g:[[(f:=f^(c>0))*5or(c:=c|v)for v in r]for r in g if[c:=0,f:=0]]
