def p(a):b=[j for j in zip(*[j for j in zip(*a)if{*j}-{0,8}])if{*j}-{0,8}];return[[[*[c:=[j for j in zip(*[j for j in zip(*a)if{*j}-{0}&{8}])if{*j}-{0}&{8}],*c,c][i],*b[i]][j-1]and(b[1-(j>i<len(b)+~j)|-(j<i>len(b)+~j)][1-(j<i<len(b)+~j)|-(j>i>len(b)+~j)]or 8)for j in range(len(b))]for i in range(len(b))]

## 213
def p(a):b,c=eval(f"{'[b for*b,in zip(*'*2}a{')if{*b}-{0}%s{8}]'*2},"*2%(*'--&&',));r=range(l:=len(b));return[[(b[i]+[c,*c,c][i])[-(F:=l+~j)]and(b[1-(F>i<j)|-(j<i>F)][1-(j<i<F)|-(j>i>F)]or 8)for j in r]for i in r]