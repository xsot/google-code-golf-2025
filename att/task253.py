p=lambda g:[[(i:=a&b)*0+max(v*(sum(g,g)[i-1:(i:=i+1)]==[v,v])for v in sum(g,[]))for a in b'[Z']for b in b'A[']

##
def p(g):f=sum(g,[]);return[[max(v*(f[(i:=i+1):i+2]==[v,v])for v in f)for a in b'[Z'if(i:=(a&b)-15)]for b in b'A[']
def p(g):f=sum(g,[]);return[[sum(v*(f[i]==f[i:=-~i%169]==v)for v in f)for a in b'[Z'if(i:=(a&b)-14)]for b in b'A[']