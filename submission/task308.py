e=enumerate
def p(g):q=range(m:=min(A:={J-sum(C)//4:N for N in sum(g,g)if len(C:=[C+A*8for(A,B)in e(g)for(C,E)in e(B)if E==N])<5or(M:=N)*0for J in C})+3>>3,1-m);return[[A.get(y*8+x,M)for x in q]for y in q]