def p(g):
 r,*s=sum(g,[]),g;*r,m,b,B=sorted({*r},key=r.count)
 for t in s*6:
  for t in s+(s:=[]):
   s+=[],
   for r in zip(*t):s+=s.pop()+[r]if{b,B}-{*r}>{b}or{*r}>{b}else[],
 for r,s in sorted((-sum(m^s for s in s for s in s),s)for s in s):
  for y,r in enumerate(g):
   for x,r in enumerate(r):
    for h,r in zip(g[y:],all((a!=r)==(m==r)==(B==a)for h,r in zip(g[y:]+g,s)for a,r in zip(h[x:x+len(r)]+g,r))*s):h[x:x+len(r)]=r
 return[r for r in zip(*[r for r in zip(*g)if B in r])if B in r]